---
kind: pipeline
type: docker
name: default


steps:
  - name: build docker
    image: plugins/docker
    settings:
      username:
        from_secret: cr_okok_docker_username
      password:
        from_secret: cr_okok_docker_password
      registry: registry2.okok.dev
      repo: registry2.okok.dev/idoge/debian11
      tags:
        - latest
        - '1.0'
      # ä¸  Dockerfile å¯¹åº”
      target: production

  - name: notify-wx
    image: lizheming/drone-wechat
    pull: always
    settings:
      corpid:
        from_secret: corpid
      corp_secret:
        from_secret: corp_secret
      agent_id:
        from_secret: agent_id
      to_user: "@all"
      title: >
        {% if success %}
        âœ… {{repo.owner}}/{{repo.name}} ç¬¬ {{build.number}} æ¬¡æ„å»ºæˆåŠŸï¼
        {% else %}
        âŒ {{repo.owner}}/{{repo.name}} ç¬¬ {{build.number}} æ¬¡æ„å»ºå¤±è´¥äº†ï¼Œå¿«æ¥ä¿®ç†ä¸‹å§ã€‚
        {% endif %}
      message: >
          {% if success %}
          ğŸ˜Šä¸»äººï¼Œ{{repo.owner}}/{{repo.name}}ç¬¬{{build.number}}æ¬¡æ„å»ºæˆåŠŸï¼
          {% else %}
          ğŸ˜­ä¸»äººï¼Œ{{repo.owner}}/{{repo.name}}ç¬¬{{build.number}}æ¬¡æ„å»ºå¤±è´¥äº†ï¼Œå¿«æ¥ä¿®ç†ä¸‹å§ã€‚
          {% endif %}
